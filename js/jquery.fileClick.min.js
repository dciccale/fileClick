(function(a){a.fn.extend({fileClick:function(b){var c={};c.defaults={hoverClass:"jUploadButtonHover",ItemTemplate:'<li class="{ItemSelector}">{FileName}<a href="#" class="jRemoveFile">X</a></li>',InputID:"InputID",InputName:"Files"};c.options=a.extend(c.defaults,b);return this.each(function(){var r=c.options,p=a(this),j=p.find(".jAttachDocument"),i=p.find(".jRemoveFile"),k=p.find(".jFileInputContainer"),m=p.find(".jInputFile"),x=p.find(".jNoAttachments"),n=p.find(".jUploadList"),e=0,h=[],l="jFile",u="jInputFile";window.fileClick=(window.fileClick||0)+1;var t=window.fileClick;function v(o){var y=g.getInstance().val();y=y.match(/[^\/\\]+$/)[0];if(d(y)){alert("Ya existe un fichero con ese nombre")}else{s(y)}j.removeClass(r.hoverClass);q()}function s(z){var y,o;e=e+1;h.push(z);y=r.ItemTemplate;y=y.replace("{ItemSelector}",l);y=y.replace("{FileName}",z);o=g.getInstance().unbind().attr({id:r.InputID+t+"_"+e,name:r.InputName+t+"[]"}).css({top:-3000});y=a(y).append(o);n.append(y);if(e>0){x.hide()}}function w(o){e=e-1;h.splice(o.index()-1,1);o.remove();if(e==0){x.show()}}i.live("click",function(y){y.preventDefault();var o=a(this).parents("."+l);w(o)});function d(y){var o;for(o=0;o<h.length;o++){if(h[o]==y){return true}}return false}function f(){var o=g.getInstance();o.bind("mouseover mouseout",function(){j.toggleClass(r.hoverClass)});if(a.browser.msie&&a.browser.version.substr(0,1)==7){o[0].attachEvent("onpropertychange",v)}else{o.change(v)}}function q(){var o=a("<input type='file' class='"+u+"' id='"+r.InputID+t+"' name='"+r.InputName+t+"[]' />");g.setInstance(o);f(o);k.html(o)}var g={setInstance:function(o){this.newInput=o},getInstance:function(){return this.newInput||m}};q();k.css({width:j[0].offsetWidth,height:j[0].offsetHeight})})}})})(jQuery);